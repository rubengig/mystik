<div class="super-wrapper">
  
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-12">

        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
          
          <div>
            <app-shared-header-unrouted
              [strTitulo]="'Usuarios'"
              [strIcono1]="'group'" 
              [strIcono2]="'admin_panel_settings'">
            </app-shared-header-unrouted>
          </div>

          <div class="d-flex align-items-center gap-3">
            
            <div class="input-group" style="width: 280px;">
              <span class="input-group-text bg-transparent">
                <i class="bi bi-search"></i>
              </span>
              <input 
                type="text" 
                class="form-control search-mystik" 
                placeholder="Buscar..."
                [(ngModel)]="strFiltro" 
                (keyup)="filter($event)"
              >
            </div>

            <a href="admin/usuario/create" class="btn-create shadow-sm">
              <i class="bi bi-plus-lg"></i>
              <span>Nuevo</span>
            </a>

          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3 px-2">
          
          <div class="info-text-mystik">
            @if (strFiltro.length > 0) {
              Filtro activo: <span class="text-highlight">"{{ strFiltro }}"</span>
            } @else {
              <span>Mostrando todos los registros</span>
            }
          </div>

          <div class="info-text-mystik">
            <span class="text-highlight">{{ oPage?.numberOfElements }}</span> 
            de 
            <span class="text-highlight">{{ oPage?.totalElements }}</span> 
            registros
          </div>

        </div>

        <div class="glass-container table-responsive">
          <table class="table table-mystik align-middle">
            <thead>
              <tr>
                <th (click)="sort('id')" class="text-center" style="width: 80px;">
                  ID
                  @if (strField === 'id') {
                    <i class="bi ms-1 small" [ngClass]="strDir === 'desc' ? 'bi-caret-down-fill' : 'bi-caret-up-fill'"></i>
                  }
                </th>
                <th (click)="sort('nombre')">
                  Nombre
                  @if (strField === 'nombre') {
                    <i class="bi ms-1 small" [ngClass]="strDir === 'desc' ? 'bi-caret-down-fill' : 'bi-caret-up-fill'"></i>
                  }
                </th>
                <th (click)="sort('apellido1')">
                  1ยบ Apellido
                  @if (strField === 'apellido1') {
                    <i class="bi ms-1 small" [ngClass]="strDir === 'desc' ? 'bi-caret-down-fill' : 'bi-caret-up-fill'"></i>
                  }
                </th>
                <th (click)="sort('apellido2')">
                  2ยบ Apellido
                  @if (strField === 'apellido2') {
                    <i class="bi ms-1 small" [ngClass]="strDir === 'desc' ? 'bi-caret-down-fill' : 'bi-caret-up-fill'"></i>
                  }
                </th>
                <th (click)="sort('email')">
                  Email
                  @if (strField === 'email') {
                    <i class="bi ms-1 small" [ngClass]="strDir === 'desc' ? 'bi-caret-down-fill' : 'bi-caret-up-fill'"></i>
                  }
                </th>
                <th class="text-center">Rol</th>
                <th class="text-center" style="width: 140px;">Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (usuario of oPage?.content; track usuario.id) {
                <tr>
                  <td class="text-center fw-bold opacity-75">{{ usuario.id }}</td>
                  <td>{{ usuario.nombre | trim : 15 }}</td>
                  <td>{{ usuario.apellido1 }}</td>
                  <td>{{ usuario.apellido2 }}</td>
                  <td class="small opacity-75">{{ usuario.email }}</td>
                  
                  <td class="text-center">
                    <span class="badge-role">
                      {{ usuario.tipousuario.descripcion }}
                    </span>
                  </td>
                  
                  <td class="text-center">
                    <div class="btn-group-mystik">
                      <button class="btn-action" (click)="view(usuario)" title="Ver">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn-action" (click)="edit(usuario)" title="Editar">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn-action delete" (click)="remove(usuario)" title="Eliminar">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="7" class="text-center py-5 text-muted">
                    No hay datos disponibles.
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-4 flex-wrap">
          
          <nav>
            <ul class="pagination pagination-sm mb-0 align-items-center">
              <li class="page-item disabled me-2"><span class="page-link border-0 bg-transparent text-muted p-0">Ver:</span></li>
              <li class="page-item" [class.active]="nRpp === 10">
                <a class="page-link" (click)="goToRpp(10)" href="#">10</a>
              </li>
              <li class="page-item" [class.active]="nRpp === 50">
                <a class="page-link" (click)="goToRpp(50)" href="#">50</a>
              </li>
              <li class="page-item" [class.active]="nRpp === 100">
                <a class="page-link" (click)="goToRpp(100)" href="#">100</a>
              </li>
            </ul>
          </nav>

          <nav>
            <ul class="pagination mb-0">
              <li class="page-item" [class.disabled]="nPage - -1 === 1">
                <a class="page-link" (click)="goToPrev()" href="#">
                  <i class="bi bi-chevron-left"></i>
                </a>
              </li>

              <li class="page-item" *ngFor="let pag of arrBotonera">
                @if(pag === '...') {
                  <span class="page-link disabled border-0 bg-transparent">...</span>
                } @else {
                  <a class="page-link" href="#" (click)="goToPage(-(-pag))" [class.active]="nPage - -1 === -(-pag)">
                    {{ pag }}
                  </a>
                }
              </li>

              <li class="page-item" [class.disabled]="nPage - -1 === oPage?.totalPages">
                <a class="page-link" (click)="goToNext()" href="#">
                  <i class="bi bi-chevron-right"></i>
                </a>
              </li>
            </ul>
          </nav>

        </div>

      </div>
    </div>
  </div>
</div>